///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//		avr_base library
//			Author: Pablo Ramon Soria
//			Date:	2014/09/21
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "InterruptMgr.h"

namespace avr_base{
	namespace hal{

		//-------------------------------------------------------------------------------------------------------------
		// Static member initialization
		std::uint8_t InterruptMgr::nLocks = 0;

		//-------------------------------------------------------------------------------------------------------------
		void InterruptMgr::init(){
			sei();	//	 Enable global interrupts
		}

		//-------------------------------------------------------------------------------------------------------------
		void InterruptMgr::lockInterrupts(){
			cli();	//	Disable global interrupts
			nLocks++;
		}

		//-------------------------------------------------------------------------------------------------------------
		void InterruptMgr::unlockInterrupts(){
			nLocks--;
			if (nLocks == 0)
				sei();

		}

		//-------------------------------------------------------------------------------------------------------------
		void InterruptMgr::startInterrupt(){
			nLocks++;
		}

		//-------------------------------------------------------------------------------------------------------------
		void InterruptMgr::endInterrupt(){
			nLocks--;
		}

	}	//	namespace hal
}	//	namespace avr_base